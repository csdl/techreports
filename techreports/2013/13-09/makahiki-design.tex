\chapter{Makahiki Design}
\label{cha:makahiki-design}

This chapter describes the design of the Makahiki, a serious game framework for sustainability. It starts with an overview of Makahiki in Section \ref{sec:makahiki-design-overview}, followed by a  description of the Makahiki system in Section \ref{sec:makahiki-design-description}. Section \ref{sec:makahiki-design}
 describes the architecture of Makahiki, followed by the design features that make Makahiki an innovative serious game framework.

\section{Overview}
\label{sec:makahiki-design-overview}

Makahiki is an open source ``serious game framework for sustainability." It provides a framework for creating serious games for the purpose of education and behavioral change regarding energy, water, food, and waste generation and use.

The initial version of Makahiki (Version 1) was originally developed as a custom built software solution \cite{csdl2-11-01} for the Kukui Cup Energy Competition \cite{csdl2-10-08} at the University of Hawaii. The first version of Makahiki provided the following functionalities to support energy challenges at the University of Hawaii: a) A synergistic mixture of real-world and virtual world activities to raise  consciousness and literacy regarding energy issues; b) Real-time feedback on energy consumption by residence hall teams; c) Incentives in the form of prizes and raffle games. d) Social networks, both physical (residence hall teams) and virtual (Facebook).

The current version of Makahiki (Version 2) builds upon the prior version with the purpose of providing a serious game {\bf Framework} for sustainability that enables different organizations to easily create customized serious games in the context of sustainability education and behavioral change. In additional to the features from version 1, the current Makahiki framework includes the following features:

\begin{itemize}
\item The ability to tailor system functionality to support the requirements of different organizations.
\item The ability to support sustainable resource challenges such as water, food, and waste in addition to energy.
\item The ability to extend the framework with new mini-games and modules to support different requirements.
\item The use of HTML5/CSS3 ``responsive'' design techniques for support of laptop, tablet, and smart phone interfaces.
\item Real-time game analytics to help assess the impact of game mechanics during challenges.
\item Support for PaaS (Platform as a Service) facilities such as Heroku. This enables organizations to create and deploy challenges without obtaining physical hardware and its requisite IT support.
\end{itemize}

The design of Makahiki follows closely the serious game lifecycle using a framework as illustrated in \autoref{fig:serious-game-lifecycle}. In Makahiki, the system admins install or create a new default game instance by instantiating from the Makahiki framework; then the game designers configure or customize the instance according to their organization's specific needs. if needed, the game developers extend the instance by adding new game widgets. The system admins deploy the finalized instance to the infrastructure of the choice of the organization, either locally or to the cloud. Once the game instance is deployed and running, the game managers can manage the game and the players play the game. In Makahiki, the game analytics are available realtime during the game and after the game. 

The next section describes Makahiki as it is viewed by the user roles in a serious game lifecycle using the Makahiki framework.

\section{System Description}
\label{sec:makahiki-design-description}

This section describes Makahiki from the perspectives of different user roles. It first describes the installation process from the system administrator's view, followed by the descriptions of different system interfaces to players, game designers, game managers and developers.
 
\subsection{System Admin Interface}

This section describes the system admin interface of the Makahiki system from the perspective of system administrators. It includes the software installation which is part of the game instantiation, and the deployment of the instance.

The design goal Makahiki installation and deployment is to make it an easy process to support different IT infrastructure. Different organizations can choose the best installation and deployment methods that are suitable for them depending on their infrastructure and IT support capacity. 

Makahiki supports two forms of installation and deployment: local (on your own machine) and cloud-based (to the Heroku application hosting service). Organizations can install Makahiki locally if they wish to host the system themselves. This requires sufficient hardware resources and IT support to do the installation, perform backups, and monitor the system during the challenge and deal with any outages that occur.

Organizations can instead choose to host Makahiki with Heroku\cite{heroku}, a popular cloud-based Platform as Service (PAAS).  Like most cloud services, this type of installation incurs a cost depending on the service level, but has the benefit that no hardware or IT resources are required.

\autoref{table:installation} outlines the installation steps for both local and cloud environments. 

\begin{table}[ht!]
  \centering
  \begin{tabular}{|P{0.27\columnwidth}|p{0.42\columnwidth}|P{0.21\columnwidth}|}
    \hline
    \tabhead{Installation Step} &
    \tabhead{Local} &
    \tabhead{Cloud} \\
    \hline
    1. download software &
    git clone or download from website &
    git clone \\
    \hline
    2. Install tools and dependencies & 
    Python, C compiler, Pip, Virtual environment, Python Imaging Library, Memcache, PostgreSQL &
    Heroku client \\
    \hline
    3. Initialize a server instance &
    initialize\_instance &
    initialize\_instance --heroku \\
    \hline
    4. (Optional) Configure SSL & install webserver, enable SSL & addons:add ssl \\
    \hline
    5. Start up the server &
    manage.py run\_gunicorn &
    automatically started in previous step \\
    \hline
  \end{tabular}
  \caption{Installation process}
  \label{table:installation}
\end{table}

The main difference between local and cloud installation is step 2, ``Install tools and dependencies''. For a local install, all the tools and dependencies will need to be installed manually by system administrators, including the C compiler, Pip and Virtual environment, Python imaging library, memcache as the caching system, and finally the PostgreSQL database, as well as the configuration of the database. This requires adequate skills from system administrators. On the other hand, cloud installation only requires the installation of a single Heroku client. In the case of cloud installation, all  Makahiki dependencies including the PostgreSQL database are satisfied by the instance created in the Heroku cloud, thus minimizing the involvement of system administrators. 

Some organizations may want to use HTTPS / SSL to secure communication between the player browser and the website. In the local installation scenario, the system administrator can install a web server such as Apache or Nginx, then configure and enable HTTPS with SSL, and finally configure to route web requests from the web server to the Django application process. Although a fairly standard web server configuration, this local installation step requires a certain level of skill and effort. In contrast, running a Heroku client command ``heroku install addons:add ssl'' enables the SSL add-on for the application when using cloud-based hosting. For more details, please see the Makahiki installation guide \cite{makahiki-manual} chapter 2.

After the instance is created, the system admin can use the system admin interface to configure the system related settings, such as   authentication, wattdepot server connectivity, and email server. \autoref{fig:makahiki-sys-settings} shows the system admin interface.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-sys-settings, width=1\columnwidth}
\end{center}
\caption{System Admin Settings Page}
\label{fig:makahiki-sys-settings}
\end{figure}

\subsection{Game Designer Admin Interface}

Game designers use the ``Challenge Design'' admin interface to design and configure the game related settings. There are two categories of settings, one is the challenge settings, the other is the game settings. 

The challenge settings define the global configuration of the challenge such as the name and logo of the challenge, the round definition and the point system. The player settings are also defined in this section, as well as other configurable settings such as page, help, templates and the smart grid game content library. 

The game settings define the configurations for each individual games and game mechanics in Makahiki. \autoref{fig:makahiki-designer-settings} shows the challenge design interface.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-designer-settings, width=1\columnwidth}
\end{center}
\caption{Challenge Design Settings Page}
\label{fig:makahiki-designer-settings}
\end{figure}

\clearpage

Makahiki provides a Smart Grid Game Designer page  for game designers to design the smart grid game. It provides a WYSIWYG interface to create educational content, design the grid layout and levels. Game designers use this page to construct the Smart Grid Game, by dragging and dropping the squares (game actions) into the grid with the intended layout. The interface is shown in \autoref{fig:makahiki-designer}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-designer, width=1\columnwidth}
\end{center}
\caption{Smart Grid Game Designer Page}
\label{fig:makahiki-designer}
\end{figure}

\clearpage

\subsection{Player Interface}

This section describes the web interface that is viewed by the players of the Makahiki system. Because Makahiki provides the functionality for a game designer to configure and customize the game he creates, the elements and looks in the player interfaces described here are also customizable. 

\subsubsection{Landing Page}
\autoref{fig:makahiki-landing} shows a sample landing page of Makahiki system.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-landing, width=1\columnwidth}
\end{center}
\caption{Landing page}
\label{fig:makahiki-landing}
\end{figure}

The landing page is the first page encountered by new player. So far, challenges built using Makahiki have a ``closed'' registration model; that is, the users of the system are known in advance and set up during the configuration process. Thus, the landing page has two buttons: one for users who live in a particular place and thus should have access to the system, and one for those who are just visiting and would like to learn more about the system.

Most of the content on this page is configurable, including the University logo, the slogan, the text fields and button contents, and the sponsors.

\autoref{fig:EWC-landing} shows another landing page that is customized to be used in the Kukui Cup at East West Center.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=EWC-landing, width=1\columnwidth}
\end{center}
\caption{Landing page for East West Center Kukui Cup}
\label{fig:EWC-landing}
\end{figure}

\clearpage

\subsubsection{Authentication Page}

Users who click on the top button on the landing page are taken to an authentication page. Makahiki supports CAS (Central Authentication Service), LDAP, and Django internal authentication mechanisms. Different organizations can choose to configure the desired  authentication method for their game. They can use any one or combination of the above methods. \autoref{fig:makahiki-auth} shows the University of Hawaii Kukui Cup authentication screen that use the CAS authentication. \autoref{fig:EWC-auth} shows another authentication screen, the Django internal authentication, which is used in the East West Center Kukui Cup.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-authentication, width=0.6\columnwidth}
\end{center}
\caption{Authentication page for University of Hawaii Kukui Cup}
\label{fig:makahiki-auth}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\epsfig{file=EWC-auth, width=0.6\columnwidth}
\end{center}
\caption{Authentication page for East West Center Kukui Cup}
\label{fig:EWC-auth}
\end{figure}

\clearpage

\subsubsection{Home Page}
After logging in, the players are taken to the Home page, as shown in \autoref{fig:makahiki-home}. The system sets a cookie when the player authenticates successfully, thus, after the first visit, the player will normally go directly to the home page when retrieving the challenge URL.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-home, width=0.9\columnwidth}
\end{center}
\caption{Home page}
\label{fig:makahiki-home}
\end{figure}

There are three UI components in the home pages that also appear on every page. They are:

\begin{itemize}
  \item The ``Info Bar'' is a horizontal UI component at the top of every page. It provides status information about the challenge as well as a logout link. (The player will not normally need to logout unless they are accessing the site from a public computer.)
  \item The ``Nav Bar'' is a horizontal UI component below the Info Bar, which provides icons that link to all of the top-level pages in the system. The set of pages in the system is configurable.
  \item The ``Quest Bar'' is a horizontal UI component below the Nav Bar. It provides ``Quests'' (explained in more detail below).
\end{itemize}

In the center of the home page are the clickable icons and description buttons that link to the main functional pages of the game. It provides a top level glance of the functionalities of the game. The set of functional pages is configurable using the game design admin interface. \autoref{fig:HPU-home} shows another home page that is used in the Hawaii Pacific University (HPU) Kukui Cup. Note that there is no ``Drop Down'' function (for the water conservation game) in the HPU's home page.  There are two additional buttons of ``Status'' and ``Settings'' in HPU's home page which are only available to the site administrators. The background and the color theme are also different.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=HPU-home, width=0.9\columnwidth}
\end{center}
\caption{Home page for Hawaii Pacific University Kukui Cup}
\label{fig:HPU-home}
\end{figure}

The following sections describe in detail each of these top-level functional pages.

\subsubsection{Get Nutz Page}
The ``Get Nutz'' page provides the user interface to the primary sustainability education game, also known as the ``Smart Grid Game''. Players gain points by clicking on cells in the Smart Grid UI widget, which takes them to the online or real-world educational actions such as activities, commitments and events.

\autoref{fig:makahiki-getnutz2} shows an example of the Get Nutz page (the name of this page and any other top-level page can be configured by the game designer).

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-get-nutz2, width=0.9\columnwidth}
\end{center}
\caption{Get Nutz Page}
\label{fig:makahiki-getnutz2}
\end{figure}

The page also provides widgets about upcoming events, a scoreboard showing top scoring leaders and a widget called ``Active Participation Game.'' The set of widgets appearing on this page is configurable. The game designer can use the game design admin interface to customize what widgets to include and where the widgets appear. 

\clearpage

\autoref{fig:makahiki-getnutz} shows an another example of the Get Nutz page, which displays a different layout of the Smart Grid Game, and a different position for the ``Upcoming Events'' widget. There is no ``Active Participation Game'' in this page.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-get-nutz, width=1\columnwidth}
\end{center}
\caption{Another Get Nutz Page}
\label{fig:makahiki-getnutz}
\end{figure}

\clearpage

Clicking on the link in the middle of the smart grid game takes the player to a page explaining that educational action.  \autoref{fig:makahiki-action} shows an example of the action page. 

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-excursion, width=1\columnwidth}
\end{center}
\caption{Action Page}
\label{fig:makahiki-action}
\end{figure}

\clearpage

\subsubsection{Go Low Page}

The ``Go Low'' page provides the user interface to two ``energy'' games, as shown in \autoref{fig:makahiki-golow}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-go-low, width=0.8\columnwidth}
\end{center}
\caption{Go Low Page}
\label{fig:makahiki-golow}
\end{figure}

On the left side, the ``Daily Energy Goal Game'' is designed to incentivize players to reduce their energy usage by awarding them points if they can reduce their team's energy by a certain percentage below a baseline value. The stoplight visualization tells them whether or not they are currently on track to make the reduction goal.

On the right side, the ``Current Power'' visualization helps players to see what their current power consumption is in near real-time (typically every 10-15 seconds.)

The page also enables team members to communicate via a shared chat window, and provides a scoreboard widget showing leaders in energy conservation.

\clearpage

\subsubsection{Drop Down Page}

The ``Drop Down'' page provides the user interface to the ``water'' games, as shown in \autoref{fig:makahiki-dropdown}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-dropdown, width=1\columnwidth}
\end{center}
\caption{Drop Down Page}
\label{fig:makahiki-dropdown}
\end{figure}

On the left side, the ``Daily Water Goal Game'' is designed to incentivize players to reduce their water usage by awarding them points if they can reduce their team's water usage by a certain percentage below a baseline value. The calendar visualization tells them whether or not they made the goal for the individual day during the current round of the competition.

On the right side, the ``Water Goal Game Scoreboard'' shows the leaders in water conservation.

\clearpage

\subsubsection{News Page}

The ``News'' page provides information about the state of the challenge and the team of which this player is a member, as shown in \autoref{fig:makahiki-news}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-news, width=1\columnwidth}
\end{center}
\caption{News Page}
\label{fig:makahiki-news}
\end{figure}

Widgets such as ``Lounge Members,'' ``Most Popular Excursion,'' ``My Public Commitments,'' etc. all provide a sense for the state of the competition and encourage players to participate by learning about what others members are doing.

\clearpage

\subsubsection{Prizes Page}

The ``Prizes'' page provides access to two games: the ``Top Scorer'' game and the ``Raffle'' game, as shown in \autoref{fig:makahiki-prizes}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-prizes, width=0.8\columnwidth}
\end{center}
\caption{Prizes Page}
\label{fig:makahiki-prizes}
\end{figure}

The Top Scorer game, illustrated by the widget on the left, shows the prizes that can be won by top scorers in the competition.

The Raffle Game provides an alternative route to win a prize. Here, players earn in-game raffle tickets based upon their point score that can be allocated to any of a collection of raffle prizes. The odds of winning are based upon the percentage of their tickets allocated to the prize, which is picked at random at the end of a round by administrators.

The Raffle Game provides an incentive for players to do activities and earn points even if they do not stand a chance of winning one of the Top Scorer prizes.

\clearpage

\subsubsection{Profile Page}

The ``Profile'' page provides access to profile information for this player, as shown in \autoref{fig:makahiki-profile}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-profile, width=1\columnwidth}
\end{center}
\caption{Profile Page}
\label{fig:makahiki-profile}
\end{figure}

The user can set their display name, their picture, and how they wish to be contacted for reminders. It also shows information about their badges and a complete record of how they earned all of the points in the game.

The profile page also allows them to change the theme associated with the site. A variety of themes are available. In this configuration, the default theme is ``Forest'', but users can go to the Profile page to set a different theme according to their own personal preferences. Makahiki bundles 8 different themes that can be selected from the theme dropdown menu in the Profile page. Makahiki also provides a development interface for UI developers to create more themes and include new themes into the system. 

\clearpage

\autoref{fig:makahiki-profile-theme-google} and \autoref{fig:makahiki-profile-theme-space} shows two other themes that a player can select to customize the theme for his game interface.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-profile-theme-google, width=0.75\columnwidth}
\end{center}
\caption{Profile Page with the Google theme}
\label{fig:makahiki-profile-theme-google}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-profile-theme-space, width=0.75\columnwidth}
\end{center}
\caption{Profile Page with the Space theme}
\label{fig:makahiki-profile-theme-space}
\end{figure}

\clearpage

\subsubsection{Help Page}

The final page available to players is the Help page, which simply provides access to explanatory material about the system, as shown in \autoref{fig:makahiki-help}:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-help, width=1\columnwidth}
\end{center}
\caption{Help Page}
\label{fig:makahiki-help}
\end{figure}

\clearpage

\subsection{Game Manager Admin Interface}

A game manager uses the ``Challenge Management'' admin interface to manage the game. He can view and search the system logs to identify errors, view the goal status for energy and water usage reduction, monitor the wall postings from the players, etc. 

In order to manage the individual games in the challenge, a game manager uses the game management section for each game. For example, in the Energy and Water game section, he can view the energy and water usage in the case of the usage data is automatically retrieved from smart meters. In the case of not using smart meters, a game manager can use this interface to manually enter the usage data. 

One important task to manage the Smart grid game is to approve the submissions from players. The game manager can use the ``Action Submissions'' link in the smart grid game management section to view the submissions and approve them, as well as generate the bonus point coupons to be handed out to players. 

\autoref{fig:makahiki-manager-settings} shows the challenge management interface.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-manager-settings, width=1\columnwidth}
\end{center}
\caption{Challenge Management Settings Page}
\label{fig:makahiki-manager-settings}
\end{figure}

\clearpage

\subsection{Game Developer Admin Interface}

Game developers use the ``Developer'' admin interface to debug the system, add and configure new pages and games. \autoref{fig:makahiki-developer-settings} shows the developer interface.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-developer-settings, width=1\columnwidth}
\end{center}
\caption{Developer Settings Page}
\label{fig:makahiki-developer-settings}
\end{figure}

\clearpage

\subsection{Game Analytics}

The ``Status'' page is restricted to administrators such as game designers and game managers. It provides the game analytics which displays numbers of analytics widgets about the state of an ongoing challenge and the results of the challenge. \autoref{fig:makahiki-status} shows a screenshot of part of the Status page:

\begin{figure}[!ht]
\begin{center}
\epsfig{file=guided-tour-status, width=1\columnwidth}
\end{center}
\caption{Status Page}
\label{fig:makahiki-status}
\end{figure}

The Status page is designed to help administrators monitor the progress of their challenge, detect problems with the system and/or state of play, and intercede to correct them in a timely manner.

\clearpage

\section{System Design}
\label{sec:makahiki-design}

This section describes the design of Makahiki, It first illustrates the architecture of Makahiki, followed by the descriptions of design
features that makes Makahiki an innovative serious game framework.

\subsection{Architecture}

\autoref{fig:makahiki-architecture} illustrates the overall architecture of Makahiki. The core component of Makahiki is a configurable game engine that can be customized to the needs of different organizations.  It includes two libraries of games and game mechanics. These libraries consist of a set of pre-built ``widgets.'' By selecting and configuring these game and game mechanics widgets, an organization can create a customized energy and water challenge (or serious game) in which players compete both individually and in teams, earn points by reducing their energy consumption as well as by learning about energy concepts in general, and are provided with incentives such as top score prizes and raffle prizes.  

\begin{figure}[!ht]
\begin{center}
\epsfig{file=makahiki-system-architecture, width=0.9\columnwidth}
\end{center}
\caption{Architecture of Makahiki}
\label{fig:makahiki-architecture}
\end{figure}

Makahiki interfaces with the outside environment in three different ways.

First, the top side of the architecture diagram shows that Makahiki has two primary user interfaces: one for the players of the serious game, who directly interact with the game and game mechanics widgets; the other for the administrators of the system, who configure the system and monitor the real-time game analytics.

Second, the right side of the diagram illustrates that Makahiki must obtain real-world environmental data as the challenge progresses in order to provide feedback to users about the impact of their actions. In some cases, environmental data can be input automatically into the system through a combination of ``smart'' meters and additional services (such as the WattDepot system for energy data collection, storage, and analysis). If that is not possible, then manual meters can be read by administrators on a regular (typically daily) basis and input into Makahiki using the administrator interface.

Third, the bottom side illustrates that Makahiki stores its data in a database repository (currently PostgreSQL). To reduce database access and improve performance, Makahiki provides support for caching (currently memcached).

\autoref{fig:makahiki-internal-architecture} illustrates the internal architecture of Makahiki. It provides a perspective on Maka-hiki's internal architecture in terms of three kinds of ``components'': Django-related infrastructure, Widgets, and Managers.

\begin{figure}[!ht]
\begin{center}
\epsfig{file=makahiki-internal-architecture, width=0.9\columnwidth}
\end{center}
\caption{Internal Architecture of Makahiki}
\label{fig:makahiki-internal-architecture}
\end{figure}

Managers are modules that provide Makahiki capabilities that do not involve a (player) user interface. They might provide interaction with administrators via the Django admin interface. Managers can implement game mechanic data structures (such as scores, players, and teams) or more generic web service functions (transactions, authorization, etc.)

\begin{table}[ht!]
  \centering
  \begin{tabular}{|P{0.2\columnwidth}|p{0.15\columnwidth}|p{0.55\columnwidth}|}
    \hline
    \tabhead{Manager} & \tabhead{Module Name} & \tabhead{Functionality} \\
    \hline
    Authentication Manager & auth\_mgr &
    Provides authentication services for Makahiki including administrative logins and CAS authentication \\
    \hline
    Cache Manager &  cache\_mgr &
    Manages caching data structures \\
    \hline
    Challenge Manager & challenge\_mgr &
    Maintains state information about an entire Challenge, including what widgets are enabled, the round information \\
    \hline
    Log Manager &  log\_mgr &
    Provides logging services to track the actions of logged in users \\
    \hline
    Player Manager & player\_mgr &
    Supports definition and processing of players \\
    \hline
    Resource Manager & resource\_mgr &
    Provides supports for resource management, such as updating energy or water data, checking daily goals \\
    \hline
    Score Manager &  score\_mgr &
    Manages score keeping, scoreboard calculation \\
    \hline
    Team Manager & team\_mgr &
    Support definition and management of teams \\
    \hline
  \end{tabular}
  \caption{Makahiki Internal Manager Modules}
  \label{table:managers}
\end{table}

Widgets are modules that provide Makahiki capabilities that do include a player user interface. Widgets can be roughly characterized in three ways. ``Info widgets'' provide state information about the challenge to players but little in the way of interaction. ``Mechanics widgets'' provide game elements such as Quests and Badges. The third category, ``game widgets'', refer to full-fledged interactive games.

\subsection{A Library of Configurable Games and Mechanics}

Makahiki builds in a set of configurable games and mechanics that can be turned on or off, or customized by the game designers to the needs of different organizations. The rest of this section describes these games and game mechanics and how to configure them.

\subsubsection{Selecting a Game or Game Mechanics from the Library}
A challenge designer can decide which of the built-in game and mechanics will appear in a sustainability challenge for his organization. The challenge design setting page includes a widget called ``Game Settings'', which lists the set of games available and whether or not they are currently enabled, as is shown in \autoref{fig:game-display-widget}.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{game-display-widget.eps}
  \caption{Selecting a Game from Game Settings}
  \label{fig:game-display-widget}
\end{figure}

The small green and red icons on the right side indicate whether a game is currently enabled for the challenge. In this case, all of the games but one (Water Game) are enabled. Clicking on the title of a game will let you enable or disable the game and its widgets. After clicking on the title link in the Game Admin widget, a page similar to the \autoref{fig:game-settings} will appear:

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{game-settings.eps}
  \caption{Change a Game's Setting}
  \label{fig:game-settings}
\end{figure}

You can check or uncheck the ``enabled'' checkbox to enable or disable the game.

A game's UI is represented by a set of widgets which is visible in the game website. The widgets belonging to a game are listed under the ``Game Settings'' section, as shown in the above screen shot. If you disable the game, all the widgets belonging to this game will be hidden in the web page.

Makahiki currently allows you to create a challenge out of the following games and game mechanics:

\begin{itemize}

\item {\em Energy Game}. This game awards points to players depending upon their ability to lower their energy consumption.

\item {\em Water Game}. This game awards points to players depending upon their ability to lower their water consumption.

\item {\em Smart Grid Game}. This game is the principle interface to the educational component of Makahiki. The SGG awards points to players for successfully completing activities, commitments, excursions, and events.

\item {\em Top Score Game}. This game awards prizes to players and teams for earning the highest number of points during a round.

\item {\em Raffle Game}. This game awards prizes to players if they have allocated their raffle tickets to a particular raffle prize, and that raffle ticket was randomly selected by the system at the end of a round.

\item {\em Participation Game}. This game awards points to players if they can successfully get a certain percentage of their team members to participate in the challenge.

\item {\em Quest Game Mechanics}. This game mechanic provides a way for players to learn about features of the challenge by guiding them through Quests.

\item {\em Badge Game Mechanics}. This game mechanic provides a way for players to earn badges for playing the game in a variety of ways.

\item {\em Referral Game Mechanics}. This game mechanic provides a way for players to earn points by getting other people to participate in the challenge.

\end{itemize}

The following sections explain the design and configuration of each game and game mechanics.

\subsubsection{Energy and Water Game}

A fundamental requirement for enabling more active participation in sustainability behavior is feedback regarding their resource such as energy and water usage. The Energy and Water game in Makahiki are implemented as the Daily Resource Goal Game, which includes Daily Energy Goal Game and Daily Water Goal Game.

The Daily Energy Goal Game widget provides a way for players to see the outcome of the energy reduction behavior, and to make it a game by earning points from their behavior. By reducing their teams' daily energy consumption from a baseline by a set percentage, the players in the team will all earn a configurable amount of points. This baseline is calculated using historical data and recalculated dynamically throughout the competition. Both the baseline data and the current consumption is typically provided by API calls from Makahiki to an underlying WattDepot server. \autoref{fig:DailyEnergyGoal} illustrates this widget.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.7\columnwidth]{daily-energy-goal-game.eps}
  \caption{Daily Energy Goal Game widget}
  \label{fig:DailyEnergyGoal}
\end{figure}

As you can see, this interface uses a stoplight metaphor to show at a glance whether or not the team is making the goal. In this case, the stoplight is green, indicating they are currently below the goal.

The goal for each team is typically a percent reduction from their baseline usage. When a player goes to the ``Go Low'' page of Makahiki, they can view their team's current progress toward their daily energy goal. Near the end of the day, Makahiki checks the energy data from Wattdepot to see if a floor reached their goal. If the floor did reach their goal, each member of the floor that is participating in the game receives points. The energy goal game provides a link between the energy conservation competition and the point competition.

While the stoplight visualization provides good feedback to a team regarding their current progress toward making the current day's goal, we have found additional perspectives to also be useful.

One useful perspective to a team is a realtime power meter visualization that shows the current power usage of a team, as shown in \autoref{fig:PowerMeter}.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.5\columnwidth]{power-meter.eps}
  \caption{Power Meter widget}
  \label{fig:PowerMeter}
\end{figure}

This visualization displays the realtime power consumption which updates at a specified interval. This gives players a sense of energy consumption at the moment. For example, someone turns on a high power microwave, they might see a spike in the realtime power meter reflecting the power usage at that moment.

Another useful perspective to a team is a historical, calendar-based visualization that shows the results of the energy goal game for each day of the current round, as shown in \autoref{fig:degg-calendar}.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.7\columnwidth]{degg-calendar.eps}
  \caption{Daily Energy Goal Game Calendar widget}
  \label{fig:degg-calendar}
\end{figure}

This visualization is useful for helping teams to see if there are patterns to their ability to make their goal. The above display shows that they have been making their goal more regularly in the recent past, indicating perhaps that they have identified a useful strategy for conservation.

Yet another perspective of the energy consumption is illustrated in \autoref{fig:degg-scoreboard}. It is the Daily Energy Goal Game Scoreboard, which shows how teams are faring relative to each other. It can incentivize teams to conserve not only to earn points, but also to do better than other teams with respect to energy consumption. The scoreboard shows that the number of times that a team makes their daily energy goal and the average reduction percentage.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.6\columnwidth]{degg-scoreboard.eps}
  \caption{Daily Energy Goal Game Scoreboard}
  \label{fig:degg-scoreboard}
\end{figure}

The Daily Water Goal Game is similar to the Energy Goal game, with the only difference being the data, and whether the data is automatically or manually collected. With the installation of smart water meters and the availability of an automatic data collection system, all the visualizations discussed above will be available to the Water game. Otherwise, the water consumption data will have to be manually input daily. In this case, the hourly Water Goal Game widget and the near realtime Power Meter widget will not be available to the players, while the daily water scoreboard widget and calendar view widget will be available.

\clearpage

\subsubsection{Smart Grid Game}

Smart Grid Game (SGG) is Makahiki's approach to support ``gamified'' delivery of educational experiences. It is the primary place players go to learn about sustainability issues and earn points. Educational actions are organized into a grid of squares (hence the name ``Smart Grid'') and organized by category columns and levels. Players use its grid interface to discover ``actions'' they can perform. Successful completion of an action earns the player a variable number of points depending upon the difficulty of the action, and can potentially ``unlock'' additional actions and higher levels in the SGG. \autoref{fig:SmartGrid} shows a typical Smart Grid Game interface for players:

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{smart-grid.eps}
  \caption{Smart Grid Game widget}
  \label{fig:SmartGrid}
\end{figure}

There are three types of actions in the grid:

{\em Activities} are the most basic action available in the Smart Grid. In order to get points for an activity, a player must input a response to the system, which is reviewed and approved or disapproved by administrators. These responses can be a short textual answer or an uploaded picture. If a submission is approved, the player receives the points for their submission. Otherwise, the system notifies the player that their submission was not approved, along with a comment (written by an administrator) explaining why it was rejected. The player can change and resubmit their response and still earn the full point value for that task. 

Most activities have fixed reward points if completed. Creative activities are a special kind of activity that are worth a variable number of points, which depends on the effort made by the player and the quality of the outcome submitted. It is judged by the administrators. These activities enable players to exercise their artistic talents. 

{\em Commitments} are pledges that the player will carry out a specific action for a specific amount of time (typically 5 days). Examples include: reducing shower time, taking the stairs, and turning off the lights when leaving a room. Unlike activities, commitments are not easily verifiable, and so they are usually designed with fewer points than activities. Furthermore, a player can only enter into five commitments at any given time. After the commitment period is up, the player can declare that they completed the commitment and immediately earn the associated points. They can then enter into another commitment, including the one they just completed. 

{\em Events} are actions tied to real world meetings. To help organizers gauge interest in events, players can earn points by signing up in advance. Players that do this (and then actually attend the event) earn a signup bonus (typically 2 points). Players can also set up a reminder that is sent to their email and/or their mobile phone before the meeting takes place. At the event, a challenge administrator provides players with ``attendance codes'' printed on slips of paper that can be later entered in the system by the player to get their points. (The paper slips provide a form of verification that the player physically attended the event.) Attendance codes are generated by Makahiki and can only be used once. To discourage players from signing up and not attending, a penalty (typically 2 points) is assessed to players who do not submit an attendance code. If the player submits an attendance code for the event after receiving this penalty, the penalty is reversed. 

To make your SGG more interesting to players, and more pedagogically sophisticated, Makahiki supports the definition of ``{\em Path}'' through the educational content or actions. In most cases, when a new player sees the SGG for the first time, there should only be a few actions available to them - possibly only one. All of the rest should be locked. Makahiki provide a set of predicates that can be used to define the ``path.'' The predicates  determines if an action or level is locked or unlocked for a player, which in term depends on the outcome of another action or multiple other actions. Predicates include: completed a certain number of actions within a category, completed all actions within a category, completed  a certain action, and unlocking of an action or level after a certain date.

To incentivize players to work together during a challenge, Makahiki also supports ``{\em Social Bonus}''. The social bonus is an optional attribute of any Smart Grid Game action which awards extra points if the player has done the action with someone else. Examples of actions which commonly include a social bonus are: attending an event, recording a song related to energy, or measuring a shower water flow rate. When a player submits a response for an action that supports the social bonus, the player can provide the email address of another player who jointly completed the action. Once the other player also completes the task, the social bonus is awarded. Social bonuses are not bi-directional; if the second player does not provide the first player's email address, only the first player will get the social bonus.

Designing the Smart Grid Game is not easy; in fact, it is the most complicated task for a game designer when designing a serious game using Makahiki. Makahiki provides a tool called Smart Grid Game Designer to ease this task. The designer page is accessible only by administrators. 

\autoref{fig:game-designer} shows the basic components of the designer widget interface:

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.9\columnwidth]{smartgrid-game-designer.eps}
  \caption{Smart Grid Game Designer widget}
  \label{fig:game-designer}
\end{figure}

The Designer Widget has three columns, Library Actions, Designer Grid, and Palette. 

The Library Actions Column holds a library of Activities, Commitments, and Events. The Library is a reusable set of actions for a sustainability serious game. These actions are divided into three tabs, Activities, Commitments, Events. They are generic actions without any dates or locations associated with them. You can drag these library actions into the Designer Grid. If the Action is an Event you will be asked to provide the event date and location. After the action is dragged into the grid, you can override any of the attributes of the action to be tailored to the need of a specific instance of the serious game challenge.
 
The grid that the Smart Grid Game Designer creates is called ``draft''. Designers can adjust the Designer Grid, adding or removing actions, columns and levels and players will not see the changes until they are published. Multiple drafts can be created by saving the current grid to a different name. Multiple grids allow human game designers to explore different layouts and paths through the Smart Grid Game. Once the designer is satisfied with the draft grid, he can click the ``publish draft'' button to update the live Smart Grid Game that players will see.

The Smart Grid Game Designer also includes a Grid Consistency Checker (GCC) Tool. Because of the complexity of the grid, especially the interdependency (specified by the predicates) of the grid actions, a draft grid often contains errors and inconsistencies. The GCC will be automatically run when the ``publish the draft'' button is pressed and display all the potential errors in the grid. Users should modify the draft to fix any errors found by GCC in order to successfully publish to the live smart grid game. 

\autoref{fig:smartgrid-designer-gcc-settings} shows a list of items that checked by the GCC tool. 

\begin{figure}[ht!]
  \center
  \includegraphics[width=0.7\columnwidth]{smartgrid-designer-gcc-settings.eps}
  \caption{Grid Consistency Checker Widget}
  \label{fig:smartgrid-designer-gcc-settings}
\end{figure}

\autoref{fig:smartgrid-designer-dependency} shows the action dependency tree that is inspected by the GCC tool. 

 \begin{figure}[ht!]
  \center
  \includegraphics[width=0.7\columnwidth]{smartgrid-designer-dependency.eps}
  \caption{Action Dependency Tree}
  \label{fig:smartgrid-designer-dependency}
\end{figure}

\clearpage

\subsubsection{Top Score Game}

The Top Score Game enables you to design a challenge in which prizes are awarded to individuals and teams who earn the most points during the challenge (and/or each round in a challenge). It also enables you to award prizes to the teams that conserved the most energy (or some other resource such as water) during the challenge (and/or each round in the challenge).

The Top Score Game includes both a Leaderboard widget (Figure \autoref{fig:topscore-game-scoreboard}) that shows the top players/teams in contention for each round, and a Prizes widget (Figure \autoref{fig:topscore-game-prize}) that shows the prizes for each round and the current teams/individuals in line to win them.

\begin{figure}[ht!]
	\centering
		\subfigure[TopScore Game Scoreboard]{\label{fig:topscore-game-scoreboard}\includegraphics[width=0.5\columnwidth, height=2.3in]{topscore-game-scoreboard.eps}}
		\subfigure[TopScore Game Prizes]{\label{fig:topscore-game-prize}\includegraphics[width=0.5\columnwidth, height=2.3in]{topscore-game-prize}}
		\caption{Top Score Game}
		\label{fig:topscore-game}
\end{figure}

\clearpage

Designers can configure the prizes for a particular challenge by using TopScore Game configuration on the ``Settings'' page. \autoref{fig:topscore-game-change} shows the interface to specify a prize for the challenge.

\begin{figure}[!ht]
  \center
  \includegraphics[width=1\columnwidth]{topscore-game-change.eps}
  \caption{Specifying a TopScore Game Prize}
  \label{fig:topscore-game-change}
\end{figure}

\clearpage

\subsubsection{Raffle Game}

The Raffle Game was designed to solve the problem of incentivizing players who cannot hope to be a top competitor in the Challenge. When several hundred players are competing, only a handful have a realistic chance to be the top scorers for a round. Once a player knows they cannot beat all of the other players, there can be an urge to simply give up.

The Raffle Game is designed to enable all players to have a chance to win a wide variety of prizes, where their odds of winning increase based upon the number points they have earned in the game; thus incentivize participation from all individuals, even those who are not in the running for a top prize. \autoref{fig:RaffleGame} shows an example of the Raffle Game.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.7\columnwidth]{raffle-small.eps}
  \caption{Raffle Game widget}
  \label{fig:RaffleGame}
\end{figure}

Each round of the competition has its own set of raffle prizes and any unused raffle tickets carry over to the next round. Raffle tickets are independent from a player's score, and allocating a raffle ticket does not affect their rank. The system provides random selection of the winner of each raffle item at the end of a round.

The Raffle Game works in the following way. For every 25 points (by default) that a player earns, they receive one virtual raffle ticket. Players can dynamically allocate their tickets to any raffle prizes they are interested in at any time, up to the end of the raffle. Each round of the competition has its own set of raffle prizes and any unused raffle tickets carry over to the next round. Raffle tickets are independent from a player's score; allocating a raffle ticket does not affect their rank.

As the screen image above shows, each player can see in real-time how many Raffle Game Tickets they have earned, which prizes they have allocated them to, and the resulting percentage chance they have of winning based upon the tickets allocated by others to that same prize. Of course, these odds can change on a moment-to-moment basis as players allocate and deallocate tickets.

The Raffle Game, in addition to providing an incentive for the non-top players to earn points, also creates an incentive for players to come back to the site on a regular basis to see the updated odds associated with their choices.

Designers can configure the raffle prizes for a particular challenge by using the Raffle Game Configuration link on the ``Settings'' page. \autoref{fig:raffle-game-change} shows the interface to specify a prize for the challenge.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.75\columnwidth]{raffle-game-change.eps}
  \caption{Specifying a Raffle Game Prize}
  \label{fig:raffle-game-change}
\end{figure}

The ``Winner'' of the raffle prize is randomly picked by the system at the end of the round with odds in proportion to each player's relative allocated number of raffle tickets. At the end of the page, you can also see a list of users that allocated raffle tickets for this raffle prize.

\clearpage

\subsubsection{Participation Game}

One of the design constraints of a sustainability serious game such as the Kukui Cup challenge is that, the players associated with each team in a challenge must be specified in advance of a challenge. Thus, as the challenge runs, it is possible to know exactly what percentage of each team's players are actively playing the game (in the sense that they have logged in at least once).

The Participation Game is designed to incentivize active players on a team to recruit other members of their team to login and try the game. It does this by providing extra points to all active players on a team when the percentage participation by that team reaches certain thresholds (currently 50, 75, and 100).

The current percentage participation by a player's team is shown in a scoreboard, as shown in the \autoref{fig:participation-game-scoreboard}. Players will receive an in-game notification whenever they reach a threshold participation where points are awarded.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.4\columnwidth]{participation-game-scoreboard.eps}
  \caption{Participation Game Scoreboard}
  \label{fig:participation-game-scoreboard}
\end{figure}

To configure the participation game, click on the ``Participation Settings'' link in the Participation Game Admin widget on the ``settings'' admin page. \autoref{fig:participation-game-scoreboard} shows the settings of the participation game. You can change the points to award for each participation percentage. Currently, the percentages (50, 75, and 100) are hardwired into the system.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.7\columnwidth]{participation-game-change.eps}
  \caption{Specifying a participation Game Settings}
  \label{fig:participation-game-change}
\end{figure}

\subsubsection{Quest Game Mechanics}
One fundamental challenge faced by any game is: how do players learn how to play it? This is generally known as the on-boarding problem. Makahiki provides a configurable ``Quest Engine'', that enables the definition of quests and the dependencies among them. That enables site developers to create a kind of structured, proactive user guide for the system. Instead of stumbling on a random playable feature of the game, players learn about the capabilities of the site by performing discrete sequences of actions, called ``Quests.'' 

Quests are made available to the player in a collapsible/expandable window right below the navigation bar. The set of Quests shown to a player can depend upon their game state, so that ``simple'' Quests can be presented initially and more ``complicated'' Quests presented as the player gains in expertise. Quests generally guide the player through the various workflows of the Challenge, such as completing a task, signing up for an event, or allocating a raffle ticket.

The system shows a maximum of three Quests at a time. \autoref{fig:guided-tour-quests} shows an example of an expanded quest and its content. Once the player accepts the quest, and follows the instructions to complete the quest, the notification dialog box will appear to the player indicating the accepted quest had been completed. A new potentially harder quest will appear in the quest window replacing the completed quest.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{guided-tour-quests.eps}
  \caption{Quest Game Mechanics}
  \label{fig:guided-tour-quests}
\end{figure}

Quests are created by the administrator prior to the Challenge. Administrators have the option of specifying a set of predicates to determine when the player could be shown a Quest and when the player has completed the Quest, and it should no longer be shown.

Designers can configure the quests for a particular challenge by using Quest Game Mechanics Configuration link on the ``Settings'' page. \autoref{fig:quest-change} shows the interface to specify a quest for the challenge.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{quest-change.eps}
  \caption{Specifying a Quest Game Mechanics}
  \label{fig:quest-change}
\end{figure}

\clearpage

\subsubsection{Badge Game Mechanics}

Makahiki provides badge game mechanics to motivate and engage players. Badge mechanics is implemented in a customizable way so that  game designers can create as many badges as they like. Each badge can be triggered by the achievement of a certain award condition, which is defined by the flexible predicate system in Makahiki. 

Badges are a common game mechanic, in which players receive recognition for various accomplishments. Makahiki allows the challenge designer to specify the set of badges available in a challenge, and to define new ones. The challenge designer has the option of making badges worth points. Finally, the designer can use the Makahiki predicate system to award a badge automatically (for example, when a player has completed a Level in the Smart Grid Game), or manually award the badge through administrator action (for example, when a player reports a significant bug in the system).

In many systems, each badge has a custom design, but in Makahiki, we decided that the overhead of providing a custom graphic for each badge outweighed the benefits. Providing a custom graphic also would create complexity with another feature of Makahiki: the ability to create ``themes'' with different colors. To be consistent with the themes in Makahiki, badges have a common look and feel consisting of a circle and a multi-character ID. Its actual colors are specified by the theme, and can thus vary from theme to theme.

\autoref{fig:badge} shows an example of the badges available in the Makahiki system:

\begin{figure}[t!]
  \center
  \includegraphics[width=0.6\columnwidth]{badge.eps}
  \caption{Badge widget}
  \label{fig:badge}
\end{figure}

Designers can configure the badges for a particular challenge by using Badge Game Mechanics Configuration link on the ``Settings'' page. \autoref{fig:badge-change} shows the interface to specify a badge for the challenge.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{badge-change.eps}
  \caption{Specifying a Badge Game Mechanics}
  \label{fig:badge-change}
\end{figure}

\clearpage

\subsubsection{Referral Bonuses Game Mechanics}

Similar to the social bonus described in the Smart Grid Game above, the Referral Bonus is the game mechanics that help encourage participation by providing additional points to players who participate in activities with other players, and facilitate the entry of new players into an energy challenge.

Players are led through a setup process when logging into Makahiki for the first time. One of the steps in this process is the referral bonus. If a player was referred by another player in the system, they can use this step to input their email address. Once the new player earns a certain number of points in the competition, both players are awarded a referral bonus of a configurable number of points. Typically, going through the setup process gives you 25 points, so setting a point threshold of 30 points encourages the new player to at least complete one additional action in order to get the referral bonus.

When enabled, the referral bonus is implemented as a step in the first login process, as shown in \autoref{fig:referral-bonus}.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.85\columnwidth]{referral-bonus.eps}
  \caption{Referral Bonus Game Mechanics Widget}
  \label{fig:referral-bonus}
\end{figure}

If the new player was referred to the challenge by another player, they can use this step to input their email address. Once the new player earns 30 points in the competition, both players are awarded a referral bonus of (typically) 10 points. Typically, going through the setup process gives you 25 points, so a threshold of 30 points means the new player has to complete at least one additional task in order to get the referral bonus.

You can disable the referral game mechanics by clicking on the ``Referral Game Mechanics'' link. If referral game mechanics is disabled, then this window is omitted from the first login wizard and players will not be able to get points by referring other players.

The referral bonus also has a ``dynamic bonus'' capability. If enabled, then you can vary the amount of points awarded depending upon the participation level of the team associated with the new player. This incentivizes players to not just recruit new players for their own team, but to also recruit players for other teams who might not have much participation.

If the referral game mechanics is enabled, which is true by default, you will see the ``Referral settings'' link in the Game Admin widget. After clicking on the ``Referral Settings'' link, you will see the overview of the referral settings; clicking on any of the links, will bring you to a page (\autoref{fig:referral-change}) to change the settings:

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.85\columnwidth]{referral-change.eps}
  \caption{Changing the Referral Bonus Game Mechanics Settings}
  \label{fig:referral-change}
\end{figure}

By default, only the ``Normal'' referral points value is used. If you check the ``Start dynamic bonus'' setting, then the ``Super'' and ``Mega'' values are enabled depending upon the team participation rate of the new player.

\subsubsection{Configuring the games in a page}
Once the games and mechanics are selected, a challenge designer can decide which games to include in a page and how the game widgets appear. He can use the ``Page info'' link in the ``Challenge Design'' admin interface to configure the game widgets and the layout of a page.  \autoref{fig:page-info-settings} shows the interface for configuring a page. 

A designer can specify the location of the widgets in the page. Currently Makahiki only supports the two-column layout in a page. The ``Location'' setting specifies whether the widget will appear in the left column or right column. The ``Priority'' setting specifies the vertical order of the widget in the column. Lower priority numbers will appear closer to the top of the column. The ``Enable'' field specifies if the widget appears or not. 

In addition to the configuration for the widgets, a designer can also configure the name of the page, whether the page should appear or not, and the location order of the page in the navigation bar.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.8\columnwidth]{page-info-settings}
  \caption{Configuring a Page}
  \label{fig:page-info-settings}
\end{figure}

\clearpage

\subsection{Configurable resource}
In Makahiki, different resources can be tracked and configured. The admin interface is built in to support the configuration of different resources. Makahiki supports three kinds of resources, which have different attributes: energy, water and waste. Some resource data can be obtained automatically from smart meters, while some resource data has to be input manually. In the case of manually data entry, the time of manual entry can be configured as well. \autoref{fig:resource} shows the Makahiki admin interface to configure the resources.

\begin{figure}[!ht]
	\centering
		\subfigure[Supported resource types]{\includegraphics[width=0.7\columnwidth]{resource.eps}}
		\subfigure[Manual resource]{\includegraphics[width=0.7\columnwidth]{goalsettings.eps}}
		\caption{Configurable resource}
		\label{fig:resource}
\end{figure}

Makahiki supports both automated and manual data collection. With respect to automated energy collection, Makahiki queries a WattDepot server once an hour to get an update on each team's consumption during the previous hour, and then updates the stoplight visualization. At midnight, Makahiki determines whether the conservation goal was achieved by the team and updates the calendar-based view with the results for that day.

However, not all challenge player communities have meters that are internet-accessible and thus allow this kind of real-time, automated update. Instead, they might have a traditional, analog meter.

The Energy Goal Game can be configured to support manual data collection. To accomplish this, the challenge designers must first tell the system the time each day at which they will read the meters manually. (To make the energy goal game workable, the challenge designers must commit to reading the energy meters for each team at approximately the same time each day so Makahiki can assume the data represents equal, 24 hour intervals. Team meters can be read at different times, but the time must be consistent for each team.)

Then, each day during the challenge, the challenge designers read the meters, then login to the system and update Makahiki with the latest readings. From this, Makahiki can determine which teams made their energy goal for the previous day.

From a user interface perspective, the basic difference is that the stoplight visualization is not available. Instead, the primary interface to the Energy Goal Game is the calendar-based visualization, which shows the results for each day.

Given support for both automated and manual energy data collection,  Makahiki can also support Water Goal Games, Food Goal Games, Waste Goal Games, or any other ``resource'' for which teams are responsible. Currently, Makahiki provides built-in support for two resource goal games: energy and water. Each of those games, when enabled, results in a page devoted to that resource in the web application. The default configuration enables support for the Water Goal Game and the Water page.

Extending Makahiki to support an additional resource goal game is straightforward, but requires developer-level capabilities.

\subsection{Real-time Analytics}

Makahiki is designed to support sustainability challenges involving hundreds or thousands of users lasting weeks or months.  In these circumstances, effective use of the technology requires the ability to understand the state of the game, such as: Who is using it? What are they doing? What is the player response to activities, commitments, excursions, and events?   Such state information is important for planning purposes, such as assessing the transportation needs for an upcoming excursion by seeing how many players signed up.   It can also be used for making in-game changes to game design, such as changing the point values associated with activities to encourage or discourage participation.  It can also help identify breakdowns in game play, such as significant numbers of unallocated raffle tickets indicating that users do not understand the nature of that game mechanic.

To address these needs and others, Makahiki includes a variety of widgets that work together to provide high level overview of game play state to the administrators of a challenge. \autoref{fig:status} shows an example of two game analytic widgets.

\begin{figure}[!ht]
  \center
  	\subfigure[User Stats]{\includegraphics[width=0.48\columnwidth, height=2.1in]{user-status}}
	\subfigure[Energy Goal Status]{\includegraphics[width=0.48\columnwidth, height=2.1in]{goal-status}}
  \caption{Game analytic widgets: User Stats and Energy Goal Status}
  \label{fig:status}
\end{figure}

The left widget, User Stats, shows trends in the total number of players, the total number of new users, and the total number of players visiting the site each day.  The right widget provides information on the ability of teams to achieve their daily energy goal each day and over time.

\autoref{table:status-widgets} lists all the analytics widgets that are currently included on the ``Status'' page. More analytics widgets can be developed using the widget development API and added to the page.

\begin{table}[ht!]
  \centering
  \begin{tabular}{|p{0.24\columnwidth}|p{0.7\columnwidth}|}
    \hline
    \tabhead{Analytics Widget} &
    \tabhead{Display Content} \\
    \hline
    Player points & Rankings of all the players' points for each round \\ \hline
    Team points & Rankings of all teams' total points for each round \\ \hline
    Team participation & Rankings of all teams' participation rate for each round \\ \hline
     Team energy & Rankings of all teams' energy usage and goal meeting status for each round \\ \hline
     Team water & Rankings of all teams' water usage and goal meeting status for each round \\ \hline
     Raffle & Number of tickets for each raffle for each round \\ \hline
     Current status & The status of the submission approval queue; number of unallocated raffle tickets \\ \hline
     Event RSVPs & Number of RSVPs for each event \\ \hline
     Popular event & Number of signups and completions for each event ordered by signups \\ \hline
     Popular activity & Number of submissions and approved for each activity ordered by submissions \\ \hline
     Popular commitment & Number of signups and completions for each commitment ordered by signups \\ \hline 
     Popular quests & Number of completed quests ordered by completions \\ \hline
     Feedback (rating) & Average ratings and total number of player feedbacks for each activity \\ \hline
     Awarded badges &  Number of players awarded for each badge \\ \hline
     Referrals & Number of referrals for the players that made a referral \\ \hline
     User stats & Graph showing the total number of players, number of new users, and number of players visiting the site for each day \\ \hline
     Energy goal status & Status of all teams' meeting energy goal each day as well as the actual usage and the difference between the usage and goal \\ \hline 
     Water goal status & Status of all teams' meeting water goal each day as well as the actual usage and the difference between the usage and goal \\ \hline 
     WattDepot status & Number of seconds taken to retrieve the Wattdepot server data for each team. \\ \hline 
  \end{tabular}
  \caption{Analytics Widgets on ``Status'' Page}
  \label{table:status-widgets}
\end{table}

\clearpage

\subsection{Responsive mobile support}
We believe that mobile support is essential for this kind of sustainability challenge, especially for the new generation players. Makahiki implemented  responsive web design technology to support multiple devices to enhance the player experience. \autoref{fig:responsive} shows the responsive interface in Makahiki that supports both desktop view and mobile view with the same code base.

\begin{figure}[!ht]
  \center
  \includegraphics[width=1\columnwidth]{responsive.eps}
  \caption{Responsive design supports both desktop and mobile}
  \label{fig:responsive}
\end{figure}

\clearpage

\subsection{Cloud deployment support}
Another feature in Makahiki is the ability to deploy to a Cloud platform. Cloud computing has the advantage of simplifying IT administration by eliminating the need to acquire the hardware, install software etc, thus lowering the cost of software deployment. \autoref{fig:heroku} shows a screen shot of the Dashboard showing the 2012 East West Center Kukui Cup challenge deployed in Heroku, a cloud platform provider. The monthly cost for the IT infrastructure in this instance is quite affordable. 

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.9\columnwidth]{heroku.eps}
  \caption{Heroku cloud deployment}
  \label{fig:heroku}
\end{figure}

\autoref{section:cloud-hosting} describes in details our experiences with several real world Makahiki instances that are deployed to the Heroku cloud infrastructure. In general, for a small organization, a monthly cost of \$10 for hosting a Makahiki game instance is sufficient, such as in the East West Center case. For a large organization with about 1000 eligible players, the monthly hosting cost will be around \$100. See \autoref{section:cloud-hosting} for more discussions on the cost of cloud hosting.

As discussed in \autoref{section:cloud-hosting}, besides the cost benefit, cloud deployment has the the advantage of dynamically adjusting the computing resource for the application in both scaling up and scaling down scenarios. 

\subsection{Customization and Extension Development Support}
Makahiki, as a framework, provides facilities to help developers to create customizations and extensions to fit different requirements from the organization. The following section describes the two customizations that can be implemented by developers through minimal programming.

\subsubsection{Theme Development}
A ``theme'' in Makahiki consists of a specification of the background image (or color), as well as the background and font colors for various structural elements of the system. Players have the ability to select themes from the Profile page, making it unnecessary to develop a ``perfect'' theme for your challenge. \autoref{fig:theme-change} shows the widget that a player can use to change the theme they like the best for their personal website feel. 

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.6\columnwidth]{theme-change}
  \caption{Change the Website Theme}
  \label{fig:theme-change}
\end{figure}

Makahiki provides a set of pre-built themes for players to choose from. \autoref{fig:theme-installed} lists all the installed themes in Makahiki. These installed themes will show up in the ``Theme'' drop-down that can be selected by a player as shown in \autoref{fig:theme-change}.

\begin{figure}[!ht]
\begin{lstlisting}
##########################################################
# INSTALLED Themes. Please keep them in alphabetical order
##########################################################
INSTALLED_THEMES = (
    'theme-bubbles',
    'theme-bumblebee',
    'theme-forest',
    'theme-google',
    'theme-hpu',
    'theme-revolusun',
    'theme-sonora',
    'theme-space',
    'theme-wave',
)
\end{lstlisting}
\caption{Makahiki Pre-Built Themes Defined in settings.py}
\label{fig:theme-installed}
\end{figure}

Makahiki, as a framework, allows developers to create additional themes. Makahiki's themes are implemented using LESS, which is the  enhanced version of CSS that supports variables and other capabilities not available in standard CSS. There is no need to know about LESS in order to create Makahiki themes. Most developers should be able to create themes simply by copying and editing a pre-existing theme file and changing some of the LESS variables in the new file. All the theme files are located in the ``makahiki/static/less'' directory.  Most of the times, a theme developer only needs to pick the color for the theme and specify which color he want for a specific UI elements in the LESS file. \autoref{fig:theme-google-less} shows a snippet of the theme-google.less file.

\begin{figure}[!ht]
\begin{lstlisting}
// Google color palette
@google-white:          #FFFFFF;
@google-offwhite:       #E9EEF5;
@google-lightblue:      #8DAAEB;
@google-gold:           #E8AC13;
@google-lightlightblue: #B8CAE0;
@google-darkblue:       #1249E0;
@google-red:            #D41C34;

// Page Background
@use-bkg-image: false;
//@page-bkg-image: "../images/forest-theme-background.jpg";

@page-bkg-color-start: @google-white;
@page-bkg-color-end: @google-white;
@page-font-color: @black;
@page-link-color: @google-darkblue;

// Widgets
@widget-title-bkg-color-start: @google-lightblue;
@widget-title-bkg-color-end: @google-lightblue;
@widget-title-font-color: @black;
@widget-title-transparency: 0%;
@widget-body-bkg-color: @google-white;
@widget-body-font-color: @black;
@widget-body-transparency: 0%;

// Smart grid game
@sgg-header-bkg-color: @google-offwhite;
@sgg-header-font-color: @black;
@sgg-entry-font-color: @black;
@sgg-activity-cell-bkg-color: @google-lightblue;
@sgg-commitment-cell-bkg-color: @google-red;
@sgg-event-cell-bkg-color: @google-gold;
@sgg-excursion-cell-bkg-color: @google-darkblue;
@sgg-filler-cell-bkg-color: lighten(@black, 30%);

\end{lstlisting}
\caption{Google Theme defined in theme-google.less}
\label{fig:theme-google-less}
\end{figure}

Once the theme file is created, it should be included in the ``INSTALLED\_THEMES'' section in the settings.py file as shown in the previous \autoref{fig:theme-installed}. To see the results of the new theme, Makahiki provides a special page called ``theme-display''. The developer can use the browser to go to this page to test all of the theme-able elements in a single page. \autoref{fig:theme-google-test} illustrates the result of the new theme.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.99\columnwidth]{theme-google}
  \caption{The Result of theme-google.less}
  \label{fig:theme-google-test}
\end{figure}

\subsubsection{New Game Widget Development Support}

As discussed previously, Makahiki includes a set of pre-built game and game mechanics widgets for game designers to select and configure for their serious game challenges. In some cases, game designers may wish to implement additional games or mechanics and integrate them into the Makahiki system. It is achievable through the game widget development support of the Makahiki framework. In order to develop new games, programming knowledge of Python and Django is required. This is unlike the theme development where there is no need to know LESS or any programming. 

Developing a new widget for Makahiki includes the following four steps:

The first step is to create the new widget package structure. Makahiki provides a command line tool called ``startwidget'' integrated into the standard Django manage.py utility. It is the easiest way to create the basic file structure for a new widget. \autoref{fig:startwidget} illustrates the command to create a hello\_world widget and the base files and directory structure that are created by the tool. 

\begin{figure}[!ht]
\begin{lstlisting}
% manage.py startwidget hello_world
\end{lstlisting}
\begin{lstlisting}
hello_world/
            __init__.py
            views.py
            tests.py
            templates/
                      index.html
\end{lstlisting}
\caption{Makahiki Tool for Creating a New Widget Structure}
\label{fig:startwidget}
\end{figure}

The command creates a directory named after the new widget in the directory ``apps/widgets'', and four files underneath:
\begin{itemize}
\item {\em \_\_init\_\_.py}: this file indicates that the directory is a Python package.
\item {\em views.py}: this file implements the widget logic and provide data to the UI.
\item {\em index.html}: this file defines the UI that is displayed to players.
\item {\em tests.py}: this file provides the skeleton of the unit testing for the new widget.
\end{itemize}

These files are the starting points for building a new widget.

The second step is to implement the logic of the widget and provide the data for display. It is done in the views.py by calling the Application Programming Interfaces (APIs) provided by Makahiki. 

The Makahiki API provides a generic mechanism for supplying data to display in the widget UI.  When the player loads a page, the Makahiki module ``{\bf apps.pages.views.index}'' is called. This module determines the name of the page dynamically and creates a Python dictionary, called ``{\bf view-objects}''.  From the page configuration, it determines which widgets are enabled for the given page. It then loops over each widget and calls their ``{\bf apps.widgets.widget\_name.views.supply}'' function. So the entry point for the widget is the supply function in its views.py file. 

The startwidget command provides the empty supply function in the views.py it created, as shown in \autoref{fig:views}. 
\begin{figure}[!ht]
\begin{lstlisting}
"""Provides the view of the widget."""
def supply(request, page_name):
    """ supply view_objects for widget rendering."""
    _ = request
    _ = page_name
    return {}
\end{lstlisting}
\caption{Supply function template provided in the base views.py}
\label{fig:views}
\end{figure}

A developer needs to fill in the supply function to provide the data. Makahiki also includes a library of manager modules that provides APIs to interact with the system. \autoref{table:managers} lists all the manager modules and their functionality. 

For illustration purpose, the hello\_world widget will display three kinds of data obtained from the Makahiki system. One is the name of the player, which is stored in the name attribute of profile object. The second is the name of the team the player belongs to. It is stored in the team attribute of the profile object. The third data is the current point score of the player. It can be retrieved by calling the function ``player\_points'' in the ``score\_mgr'' module. \autoref{fig:views-example} shows the complete example of views.py for hello\_world widget.

\begin{figure}[!ht]
\begin{lstlisting}
"""Provide the view for the Hello_World widget."""
from apps.managers.score_mgr import score_mgr
def supply(request, page_name):
    """Supply view_objects contents, which are the player name, team and points."""
    _ = page_name
    profile = request.user.profile
    name = profile.name
    team = profile.team
    points = score_mgr.player_points(profile)
    return {
        "name": name,
        "team": team,
        "points": points,
    }
\end{lstlisting}
\caption{Example of a completed views.py}
\label{fig:views-example}
\end{figure}

The third step in creating a new widget is to declare the UI component. It is done in index.html under the templates directory.
\autoref{fig:index-base} shows the base index.html created by the ``startwidget'' command.

\begin{figure}[!ht]
\begin{lstlisting}
<div class="content-box">
    <div class="content-box-title">
        Widget name
    </div>
    <div class="content-box-contents">
        Widget content
    </div>
</div>
\end{lstlisting}
\caption{Generated base index.html}
\label{fig:index-base}
\end{figure}

Makahiki provides many different styles and CSS classes. Normally, widgets are contained in a content-box. A context-box is a rounded, shaded box with two parts, content-box-title, and content-box-contents. A developer can replace the ``Widget name'' in the title box and the ``Widget content'' in the content box to display the data provided from views.py. A complete example of the index.html file of the hello\_world widget is shown in \autoref{fig:index-example}. The data provided from the views.py are referenced by the convention of ``{\bf view\_objects.widget\_name.variable}''.

\begin{figure}[!ht]
\begin{lstlisting}
<div class="content-box">
    <div class="content-box-title">
        Hello World Widget
    </div>
    <div class="content-box-contents">
        Welcome <b>{{ view_objects.hello_world.name }}</b>, <br/>
          you're in team <b>{{ view_objects.hello_world.team }}</b> <br/>
          you have <b>{{ view_objects.hello_world.points}}</b> points.
    </div>
</div>
\end{lstlisting}
\caption{Example of a completed index.html}
\label{fig:index-example}
\end{figure}

Finally, the fourth step for developing a new widget is to add the widget to a page. In order for a new widget to be available to the system, you need to edit the Makahiki ``settings.py'' file and add the widget name to the INSTALLED\_WIDGET\_APPS variable. \autoref{fig:installed-widget} shows a portion of the settings.py file after adding the new hello\_world widget. 
\begin{figure}[!ht]
\begin{lstlisting}
################################
# INSTALLED Widgets
################################
INSTALLED_WIDGET_APPS = (
  'action_feedback',
  'ask_admin',
  'badge_scoreboard',
  'badges',
  'bonus_points',
  'hello_world',
  'home',
  ....
  )
\end{lstlisting}
\caption{Adding the new widget to settings.py}
\label{fig:installed-widget}
\end{figure}

This last step makes the newly developed widget available to the Makahiki system. Once it is available to the system, a game designer will be able to add the widget to an existing page using the admin interface.

The ``Page Settings'' link in the admin interface is used to configure the widgets in a page. \autoref{fig:page-settings} shows the hello\_world widget being added to the existing Profile page.

\begin{figure}[!ht]
  \center
  \includegraphics[width=0.99\columnwidth]{page-settings}
  \caption{The Hello World widget added to the left column}
  \label{fig:page-settings}
\end{figure}

The hello\_world widget is added to the left side location with the priority set to ``1'', which indicates that the new widget will be displayed first and before the ``My Info'' widget (priority 2) on the left side column on the page.  The widget will also need to be enabled by checking the ``enabled'' checkbox. \autoref{fig:hello-world-widget} shows the final result of the hello\_widget displayed in the Profile page.
\begin{figure}[!ht]
  \center
  \includegraphics[width=0.99\columnwidth]{hello-world-widget}
  \caption{The Hello World widget displayed in the Profile page}
  \label{fig:hello-world-widget}
\end{figure}

\section{Summary}
Makahiki is designed to provide an easy to use framework for different organizations to create custom sustainability related serious games. 

Makahiki provides a libraries of games and game mechanics for organizations to choose and customize from. \autoref{table:makahiki-games} lists the Makahiki built-in games and game mechanics.

\begin{table}[ht!]
  \centering
  \begin{tabular} {|P{0.2\linewidth}|P{0.6\linewidth}|P{0.1\linewidth}|}
    \hline
    \tabhead{Name} &
    \tabhead{Description} &
    \tabhead{Type} \\
    \hline
    Energy Game & awards points to players depending upon their ability to lower their energy consumption & game \\
    \hline
    Water Game & awards points to players depending upon their ability to lower their water consumption & game \\
    \hline
    Smart Grid Game & awards points to players for successfully completing activities, commitments, excursions, and events & game \\
    \hline
    Top Score Game & awards prizes to players and teams for earning the highest number of points during a round & game \\
    \hline
    Top Score Game & awards prizes to players and teams for earning the highest number of points during a round & game \\
    \hline
    Raffle Game & awards prizes to players if they have allocated their raffle tickets to a particular raffle prize & game \\
    \hline
    Participation Game & awards points to players if they can successfully get a certain percentage of their team members to participate & game \\
    \hline
    Quest & provides a way for players to learn about features of the challenge by guiding them through ``Quests'' & game mechanic\\
    \hline
    Badge & provides a way for players to earn badges for playing the game in a variety of ways & game mechanic\\
    \hline
    Referral & provides a way for players to earn points by getting other people to participate in the challenge & game mechanic\\
    \hline
  \end{tabular}
  \caption{Makahiki built-in games and mechanics}
  \label{table:makahiki-games}
\end{table}

Using the provided different admin interfaces, system admins, game designers, and game developers can configure the Makahiki in various ways. In addition, players of Makahiki can also customize the look and feel (theme) of the game once they login. \autoref{table:makahiki-configurability} shows the customizable areas in Makahiki from the perspective of different roles. The game managers also use the admin interface to manage and monitoring the game. Currently Makahiki does not provide customization from a game management perspective. \autoref{sec:future-game-manage} discusses a future Makahiki enhancement for this kind of customization.

\begin{table}[ht!]
  \centering
  \begin{tabular} {|l|P{0.7\linewidth}|}
    \hline
    \tabhead{User} &
    \tabhead{Customizable area}  \\
    \hline
    Player & 1. website look and feel (theme) \newline
                   2. upload their own profile picture\\
    \hline 
    System admin 
    & 1. methods of authentication and server configuration \newline
       2. email server configuration \newline
       3. energy data connectivity \\
    \hline 
    Game designer 
    & 1. global game settings: branding, logo, default theme, landing page\newline
       2. competition settings: teams, rounds, durations\newline
       3. selection and configuration of individual games\newline
       4. manual or automatic resource data source\newline
       5. education ``action'' contents\newline
       6. levels, layout and progression of smart grid game\\
    \hline 
     Game developer
    & 1. location of a game widget in a page \newline
        2. adding new widgets\\
    \hline
  \end{tabular}
  \caption{Configurability in Makahiki}
  \label{table:makahiki-configurability}
\end{table}

The extensive customization capability of Makahiki gives organizations great flexibility in tailoring a Makahiki serious game to suit their organizational needs. 
